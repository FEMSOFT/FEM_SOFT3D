/*
 * =====================================================================================
 *
 *       Filename:  Quadrature3D.c
 *
 *    Description:  
 *
 *        Version:  1.0
 *        Created:  2014年10月26日 16时27分55秒
 *       Revision:  none
 *       Compiler:  gcc
 *
 *         Author:  Xu Fei (Fly), xufei@lsec.cc.ac.cn
 *        Company:  
 *
 * =====================================================================================
 */
#include <stdio.h>
#include <stdlib.h>
#include "Quadrature3D.h"
#include "Mesh3D.h"
void BuildQuad2Volu3D(VOLU *volu,int N_Points, Quadrature3D *quad3d)
{
  int Num_Faces = 4;
  Produce_Quad3D(Num_Faces, N_Points, quad3d);
}
Quadrature3D *BuildQuad2Mesh3D(MESH *mesh, int N_Points)
{
  Quadrature3D *quad3d;
  quad3d = malloc(1*sizeof(Quadrature3D));
  VOLU *volu;
  volu = mesh->Volus[0];
  BuildQuad2Volu3D(volu, N_Points, quad3d);  
  return quad3d;
}

void OutPutQuad(Quadrature3D *quad)
{
  printf("Print the information for the quadrature2D:\n");
  int i;
  int N_Points;
  N_Points = quad->N_Points;
  printf("N_Points=%d\n",N_Points);
  for(i=0;i<N_Points;i++)
  {
    printf("X[%d]=%18.15f, Y[%d]=%18.15f, W[%d]=%18.15f\n",
	   i+1,quad->Quad_X[i],i+1,quad->Quad_Y[i],i+1,quad->Quad_Z[i],i+1,quad->Quad_W[i]);
  }
}
void Produce_Quad3D(int N_Faces, int N_Points, Quadrature3D *quad3d)
{ 
    switch(N_Points)
    {
      
      case 1:
	quad3d->QuadType = quad_Tetrahedral1;
	quad3d->Order = 1;
	quad3d->N_Points = 1;
	double Quad_X1[1] = {0.25};
	double Quad_Y1[1] = {0.25};
        double Quad_Z1[1] = {0.25};
	double Quad_W1[1] = {1.0};
	SetValueQuad3D(1,Quad_X1,Quad_Y1,Quad_Z1,Quad_W1,quad3d);
	//printf("use the one point quadrature on tetrahedral!\n");
	break;
      case 4:
	quad3d->QuadType = quad_Tetrahedral4;
	quad3d->Order = 4;
	quad3d->N_Points = 4;
	double Quad_X4[4] = {0.138196601125010515179541316563,
                             0.138196601125010515179541316563,
                             0.138196601125010515179541316563,
                             0.585410196624968454461376050311}; 				
	double Quad_Y4[4] = {0.138196601125010515179541316563,
                             0.138196601125010515179541316563,
                             0.585410196624968454461376050311,
                             0.138196601125010515179541316563};
        double Quad_Z4[4] = {0.138196601125010515179541316563,
                             0.585410196624968454461376050311,
                             0.138196601125010515179541316563,
                             0.138196601125010515179541316563};
	double Quad_W4[4] = {0.25, 0.25, 0.25, 0.25};
	SetValueQuad3D(4,Quad_X4,Quad_Y4,Quad_Z4,Quad_W4,quad3d);
	//printf("use the four point quadrature on triangle!\n");
	
	break;
	  
      
      case 11:
	quad3d->QuadType = quad_Tetrahedral11;
	quad3d->Order = 11;
	quad3d->N_Points = 11;
	double Quad_X11[11] = {  .25,
                   .0714285714285714285714285714286,
                   .785714285714285714285714285714,
                   .0714285714285714285714285714286,
                   .0714285714285714285714285714286,
                   .399403576166799204996102147462,
                   .399403576166799204996102147462,
                   .100596423833200795003897852538,
                   .100596423833200795003897852538,
                   .100596423833200795003897852538,
                   .399403576166799204996102147462 };  
	double Quad_Y11[11] = {.25,
                   .0714285714285714285714285714286,
                   .0714285714285714285714285714286,
                   .785714285714285714285714285714,
                   .0714285714285714285714285714286,
                   .399403576166799204996102147462,
                   .100596423833200795003897852538,
                   .399403576166799204996102147462,
                   .100596423833200795003897852538,
                   .399403576166799204996102147462,
                   .100596423833200795003897852538 };
	double Quad_Z11[11] = {  .25,
                   .0714285714285714285714285714286,
                   .0714285714285714285714285714286,
                   .0714285714285714285714285714286,
                   .785714285714285714285714285714,
                   .100596423833200795003897852538,
                   .399403576166799204996102147462,
                   .399403576166799204996102147462,
                   .399403576166799204996102147462,
                   .100596423833200795003897852538,
                   .100596423833200795003897852538 };
         double Quad_W11[11] = {-0.07893333333333333333333,
                    0.045733333333333333333333333333,
                    0.045733333333333333333333333333,
                    0.045733333333333333333333333333,
                    0.045733333333333333333333333333,
                    0.149333333333333333333333333333,
                    0.149333333333333333333333333333,
                    0.149333333333333333333333333333,
                    0.149333333333333333333333333333,
                    0.149333333333333333333333333333,
                    0.149333333333333333333333333333};
	SetValueQuad3D(11,Quad_X11,Quad_Y11,Quad_Z11,Quad_W11,quad3d);
	//printf("use the 11 point quadrature on triangle!\n");
    
	break;
	  
      case 15:
	quad3d->QuadType = quad_Tetrahedral15;
	quad3d->Order = 15;
	quad3d->N_Points = 15;
	double Quad_X15[15] = {  0.333333333333333333333333333333333,
                   0.333333333333333333333333333333333,
                   0,
                   0.333333333333333333333333333333333,
                   0.25,
                   0.909090909090909090909090909090909e-1,
                   0.909090909090909090909090909090909e-1,
                   0.727272727272727272727272727272727,
                   0.909090909090909090909090909090909e-1,
                   0.665501535736642982398804642263025e-1,
                   0.433449846426335701760119535773697,
                   0.433449846426335701760119535773697,
                   0.665501535736642982398804642263025e-1,
                   0.665501535736642982398804642263025e-1,
                   0.433449846426335701760119535773697   };  
	double Quad_Y15[15] = {  0.333333333333333333333333333333333,
                   0,
                   0.333333333333333333333333333333333,
                   0.333333333333333333333333333333333,
                   0.25,
                   0.909090909090909090909090909090909e-1,
                   0.727272727272727272727272727272727,
                   0.909090909090909090909090909090909e-1,
                   0.909090909090909090909090909090909e-1,
                   0.433449846426335701760119535773697,
                   0.665501535736642982398804642263025e-1,
                   0.433449846426335701760119535773697,
                   0.665501535736642982398804642263025e-1,
                   0.433449846426335701760119535773697,
                   0.665501535736642982398804642263025e-1 };
	double Quad_Z15[15] = { 0,
                   0.333333333333333333333333333333333,
                   0.333333333333333333333333333333333,
                   0.333333333333333333333333333333333,
                   0.25,
                   0.727272727272727272727272727272727,
                   0.90909090909090909090909090909091e-1,
                   0.909090909090909090909090909090911e-1,
                   0.909090909090909090909090909090911e-1,
                   0.433449846426335701760119535773699,
                   0.433449846426335701760119535773699,
                   0.66550153573664298239880464226304e-1,
                   0.433449846426335701760119535773699,
                   0.66550153573664298239880464226304e-1,
                   0.665501535736642982398804642263035e-1 };
	double Quad_W15[15] = { 0.602678571428571428571428571428571e-2*6,
                   0.602678571428571428571428571428571e-2*6,
                   0.602678571428571428571428571428571e-2*6,
                   0.602678571428571428571428571428571e-2*6,
                   0.302836780970891758063769725577305e-1*6,
                   0.116452490860289694108936091443380e-1*6,
                   0.116452490860289694108936091443380e-1*6,
                   0.116452490860289694108936091443380e-1*6,
                   0.116452490860289694108936091443380e-1*6,
                   0.109491415613864593456430191124068e-1*6,
                   0.109491415613864593456430191124068e-1*6,
                   0.109491415613864593456430191124068e-1*6,
                   0.109491415613864593456430191124068e-1*6,
                   0.109491415613864593456430191124068e-1*6,
                   0.109491415613864593456430191124068e-1*6 };
	SetValueQuad3D(15,Quad_X15,Quad_Y15,Quad_Z15,Quad_W15,quad3d);
	//printf("use the 15 point quadrature on triangle!\n");	  
	break;
	
      default:	  
	printf("This quadrature scheme is not implemented now!\n");
     }//end for switch
}


void SetValueQuad3D(int N_Points,double *Quad_X,double *Quad_Y,double *Quad_Z,
                    double *Quad_W, Quadrature3D *quad3d)
{
  int i;
  quad3d->Quad_X = malloc(N_Points*sizeof(double));
  quad3d->Quad_Y = malloc(N_Points*sizeof(double));
  quad3d->Quad_Z = malloc(N_Points*sizeof(double));
  quad3d->Quad_W = malloc(N_Points*sizeof(double));
  for(i=0;i<N_Points;i++)
  {
    quad3d->Quad_X[i] = Quad_X[i];
    quad3d->Quad_Y[i] = Quad_Y[i];
    quad3d->Quad_Z[i] = Quad_Z[i];
    quad3d->Quad_W[i] = Quad_W[i];
  }
}

void FreeQuad3D(Quadrature3D *quad)
{
  //printf("delete the quadrature3D object!\n");
  free(quad->Quad_X);
  free(quad->Quad_Y);
  free(quad->Quad_Z);
  free(quad->Quad_W);
  free(quad);
}
